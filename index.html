<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ‡¶ø‡¶ï ‡¶®‡¶æ‡¶Æ‡¶æ‡¶ú‡ßá‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
* {margin:0; padding:0; box-sizing:border-box; font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;}
body {background:linear-gradient(135deg,#1a5e63,#0d2e36); color:#fff; min-height:100vh; display:flex; justify-content:center; align-items:center; padding:20px;}
.container {max-width:500px; width:100%; background: rgba(255,255,255,0.1); backdrop-filter:blur(10px); border-radius:20px; padding:30px; box-shadow:0 10px 30px rgba(0,0,0,0.3); text-align:center;}
.header h1 {font-size:28px; margin-bottom:10px; display:flex; justify-content:center; align-items:center; gap:10px;}
.header p {opacity:0.8; font-size:16px;}
.current-time {font-size:18px; margin-bottom:20px; background: rgba(255,255,255,0.1); padding:10px 20px; border-radius:50px; display:inline-block;}
.countdown-container {position:relative; width:250px; height:250px; margin:0 auto 30px;}
.countdown-circle {width:100%; height:100%; border-radius:50%; background: conic-gradient(#4CAF50 0%, #2E7D32 0%, rgba(255,255,255,0.1) 0%); display:flex; justify-content:center; align-items:center; position:relative; box-shadow:0 0 20px rgba(76,175,80,0.3); transition: background 1s ease;}
.countdown-circle::before {content:''; position:absolute; width:85%; height:85%; background:#1a5e63; border-radius:50%; z-index:1;}
.countdown-content {position:relative; z-index:2; text-align:center;}
.countdown-content .icon {font-size:40px; margin-bottom:10px; color:#4CAF50;}
.countdown-content .time {font-size:32px; font-weight:bold; margin-bottom:5px; letter-spacing:1px;}
.countdown-content .label {font-size:14px; opacity:0.8;}
.prayer-status {font-size:20px; margin-bottom:30px; background: rgba(255,255,255,0.1); padding:12px 20px; border-radius:10px; min-height:60px; display:flex; align-items:center; justify-content:center;}
.prayer-times {display:grid; grid-template-columns:repeat(2,1fr); gap:15px; margin-bottom:30px;}
.prayer-card {background: rgba(255,255,255,0.1); padding:15px; border-radius:10px; transition:all 0.3s ease;}
.prayer-card.active {background: rgba(76,175,80,0.2); transform:scale(1.05); box-shadow:0 5px 15px rgba(76,175,80,0.3);}
.prayer-card.current {background: rgba(255,152,0,0.2); transform:scale(1.05); box-shadow:0 5px 15px rgba(255,152,0,0.3);}
.prayer-name {font-size:16px; margin-bottom:8px; display:flex; align-items:center; justify-content:center; gap:8px;}
.prayer-time {font-size:18px; font-weight:bold;}
.location {display:flex; align-items:center; justify-content:center; gap:10px; margin-top:20px; padding:10px; background: rgba(255,255,255,0.1); border-radius:10px;}
.footer {margin-top:20px; font-size:14px; opacity:0.7;}
.loading {display:flex; flex-direction:column; align-items:center; justify-content:center; gap:15px; padding:20px;}
.spinner {width:40px; height:40px; border:4px solid rgba(255,255,255,0.3); border-radius:50%; border-top-color:#4CAF50; animation:spin 1s linear infinite;}
@keyframes spin {to{transform:rotate(360deg);}}
.error {background: rgba(244,67,54,0.2); padding:15px; border-radius:10px; margin:20px 0; display:flex; align-items:center; justify-content:center; gap:10px;}
.retry-btn {background:#4CAF50; color:white; border:none; padding:10px 20px; border-radius:50px; cursor:pointer; font-size:16px; margin-top:10px; transition:background 0.3s;}
.retry-btn:hover {background:#388E3C;}
.time-format {display:flex; justify-content:center; gap:10px; margin:15px 0;}
.format-btn {background: rgba(255,255,255,0.1); border:none; color:white; padding:8px 15px; border-radius:20px; cursor:pointer; transition:all 0.3s;}
.format-btn.active {background:#4CAF50;}
@media (max-width:480px){.container{padding:20px;}.countdown-container{width:200px;height:200px;}.countdown-content .time{font-size:26px;}.prayer-times{grid-template-columns:1fr;}}
</style>
</head>
<body>
<div class="container">
<div class="header">
<h1><i class="fas fa-mosque"></i> ‡¶á‡¶∏‡¶≤‡¶æ‡¶Æ‡¶ø‡¶ï ‡¶®‡¶æ‡¶Æ‡¶æ‡¶ú‡ßá‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º</h1>
<p>‡¶™‡¶∞‡¶¨‡¶∞‡ßç‡¶§‡ßÄ ‡¶®‡¶æ‡¶Æ‡¶æ‡¶ú‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶∞‡¶ø‡¶Ø‡¶º‡ßá‡¶≤-‡¶ü‡¶æ‡¶á‡¶Æ ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡¶°‡¶æ‡¶â‡¶®</p>
</div>
<div class="current-time" id="currentTime">Loading current time...</div>
<div id="appContent">
<div class="loading" id="loading">
<div class="spinner"></div>
<p>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶® ‡¶è‡¶¨‡¶Ç ‡¶®‡¶æ‡¶Æ‡¶æ‡¶ú‡ßá‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>
</div>
</div>
<div class="footer"><p>‡¶®‡¶æ‡¶Æ‡¶æ‡¶ú‡ßá‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶® ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡¶Ø‡¶º‡ßÄ ‡¶ó‡¶£‡¶®‡¶æ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá</p></div>
</div>

<script>
// Global variables
let userLocation = null;
let prayerTimes = null;
let timeFormat = '12'; // default 12-hour
let lastLocation = null;

// DOM elements
const appContent = document.getElementById('appContent');
const loadingElement = document.getElementById('loading');
const currentTimeElement = document.getElementById('currentTime');

// Bangladesh divisions & districts (‡¶∏‡¶π‡¶ú ‡¶â‡¶¶‡¶æ‡¶π‡¶∞‡¶£)
const bangladeshLocations = {
  "Dhaka": ["Savar","Dhamrai","Keraniganj","Narsingdi","Gazipur","Narsinghpur"],
  "Chattogram": ["Chattogram Sadar","Fatikchhari","Anwara"],
  "Rajshahi": ["Paba","Bagha","Puthia"],
  "Khulna": ["Terokhada","Dacope"],
  // add more divisions and districts if needed
};

// Initialize app
function initApp(){
    updateCurrentTime();
    setInterval(updateCurrentTime,1000);
    getUserLocation();
}

// Get user location
function getUserLocation(){
    if(!navigator.geolocation){
        showError("‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞‡ßá ‡¶ú‡¶ø‡¶ì‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶®‡ßá‡¶á");
        return;
    }
    loadingElement.innerHTML=`<div class="spinner"></div><p>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶® ‡¶®‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>`;
    navigator.geolocation.getCurrentPosition((pos)=>{
        userLocation = {latitude:pos.coords.latitude, longitude:pos.coords.longitude};
        lastLocation = userLocation;
        getPrayerTimes();
    },(err)=>{
        if(lastLocation){
            userLocation = lastLocation;
            getPrayerTimes();
        } else {
            showError("‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶® ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶Ø‡¶º‡¶®‡¶ø‡•§ ‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶® ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§");
        }
    }, {enableHighAccuracy:true, timeout:10000, maximumAge:60000});
}

// Calculate prayer times (dummy example)
function calculatePrayerTimes(location){
    const now = new Date();
    const prayers24 = [
        {name:"Fajr",time:"05:30",duration:30,icon:"üåÖ"},
        {name:"Sunrise",time:"06:45",duration:0,icon:"‚òÄÔ∏è"},
        {name:"Dhuhr",time:"12:30",duration:40,icon:"üïå"},
        {name:"Asr",time:"15:45",duration:40,icon:"üïå"},
        {name:"Maghrib",time:"18:20",duration:15,icon:"üåá"},
        {name:"Isha",time:"19:45",duration:45,icon:"üåô"}
    ];
    return prayers24.map(p=>{
        const [h,m]=p.time.split(":").map(Number);
        let startTime=new Date(); startTime.setHours(h,m,0,0);
        let endTime = new Date(startTime);
        if(p.duration>0) endTime.setMinutes(endTime.getMinutes()+p.duration);
        if(endTime<now){startTime.setDate(startTime.getDate()+1); endTime.setDate(endTime.getDate()+1);}
        return {...p,startTime,endTime,time12:to12HourFormat(p.time)};
    });
}

function to12HourFormat(t){
    const [h,m]=t.split(":").map(Number);
    const period = h>=12?'PM':'AM';
    const hh = h%12||12;
    return `${hh}:${m.toString().padStart(2,'0')} ${period}`;
}

// Get prayer times
function getPrayerTimes(){
    loadingElement.innerHTML=`<div class="spinner"></div><p>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶® ‡¶Ö‡¶®‡ßÅ‡¶Ø‡¶æ‡¶Ø‡¶º‡ßÄ ‡¶®‡¶æ‡¶Æ‡¶æ‡¶ú‡ßá‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶ó‡¶£‡¶®‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</p>`;
    setTimeout(()=>{
        prayerTimes = calculatePrayerTimes(userLocation);
        displayAppContent();
        updateCountdown();
        setInterval(updateCountdown,1000);
    },1000);
}

// Display main app
function displayAppContent(){
    const locationText = getLocationName(userLocation);
    appContent.innerHTML=`
    <div class="time-format">
        <button class="format-btn ${timeFormat==='12'?'active':''}" onclick="setTimeFormat('12')">12-‡¶ò‡¶£‡ßç‡¶ü‡¶æ</button>
        <button class="format-btn ${timeFormat==='24'?'active':''}" onclick="setTimeFormat('24')">24-‡¶ò‡¶£‡ßç‡¶ü‡¶æ</button>
    </div>
    <div class="countdown-container">
        <div class="countdown-circle" id="countdownCircle">
            <div class="countdown-content">
                <div class="icon" id="prayerIcon">üïå</div>
                <div class="time" id="countdownTime">00:00:00</div>
                <div class="label" id="countdownLabel">‡¶Ö‡¶¨‡¶∂‡¶ø‡¶∑‡ßç‡¶ü</div>
            </div>
        </div>
    </div>
    <div class="prayer-status" id="prayerStatus">Loading prayer status...</div>
    <div class="prayer-times" id="prayerTimes"></div>
    <div class="location"><i class="fas fa-map-marker-alt"></i> <span id="locationText">${locationText}</span></div>
    `;
    updatePrayerTimesDisplay();
}

// Get location name
function getLocationName(loc){
    if(!loc) return "‡¶Ö‡¶ú‡¶æ‡¶®‡¶æ";
    // Bangladesh check
    if(loc.latitude>20 && loc.latitude<27 && loc.longitude>88 && loc.longitude<93){
        // Random district for demo
        return "‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶®: ‡¶¢‡¶æ‡¶ï‡¶æ, ‡¶∏‡¶æ‡¶≠‡¶æ‡¶∞";
    } else {
        return "‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶®: ‡¶Ö‡¶ú‡¶æ‡¶®‡¶æ ‡¶∂‡¶π‡¶∞, ‡¶Ö‡¶ú‡¶æ‡¶®‡¶æ ‡¶¶‡ßá‡¶∂";
    }
}

// Countdown function
function updateCountdown(){
    if(!prayerTimes) return;
    const now = new Date();
    let currentPrayer=null, nextPrayer=null;
    for(const p of prayerTimes){
        if(now>=p.startTime && now<p.endTime) currentPrayer=p;
        else if(now<p.startTime && (!nextPrayer||p.startTime<nextPrayer.startTime)) nextPrayer=p;
    }
    if(!currentPrayer && !nextPrayer) nextPrayer=prayerTimes[0];
    let targetTime,countdownType,displayPrayer;
    if(currentPrayer){targetTime=currentPrayer.endTime; countdownType='end'; displayPrayer=currentPrayer;}
    else{targetTime=nextPrayer.startTime; countdownType='start'; displayPrayer=nextPrayer;}
    const diff = targetTime-now;
    const hours=Math.floor(diff/(1000*60*60));
    const minutes=Math.floor((diff%(1000*60*60))/(1000*60));
    const seconds=Math.floor((diff%(1000*60))/1000);
    const timeString=`${hours.toString().padStart(2,'0')}:${minutes.toString().padStart(2,'0')}:${seconds.toString().padStart(2,'0')}`;
    document.getElementById('countdownTime').textContent=timeString;
    document.getElementById('prayerIcon').textContent=displayPrayer.icon;
    // progress
    let progress;
    if(countdownType==='start'){const totalTime=24*60*60*1000; progress=((totalTime-diff)/totalTime)*100;}
    else{const duration=displayPrayer.endTime-displayPrayer.startTime; const elapsed=now-displayPrayer.startTime; progress=(elapsed/duration)*100;}
    document.getElementById('countdownCircle').style.background=`conic-gradient(#4CAF50 ${progress}%, #2E7D32 ${progress}%, rgba(255,255,255,0.1) ${progress}%)`;
    updatePrayerStatusDisplay(currentPrayer,nextPrayer,countdownType);
    updatePrayerTimesDisplay(currentPrayer?currentPrayer.name:'');
}

// Prayer status
function updatePrayerStatusDisplay(currentPrayer,nextPrayer,countdownType){
    if(!prayerTimes) return;
    const el=document.getElementById('prayerStatus');
    if(currentPrayer){
        const t = timeFormat==='12'?currentPrayer.time12:currentPrayer.time;
        el.innerHTML=`<div><strong>${currentPrayer.name} ‡¶ö‡¶≤‡¶Æ‡¶æ‡¶®</strong><br><small>‡¶∂‡ßá‡¶∑ ‡¶π‡¶¨‡ßá ${document.getElementById('countdownTime').textContent}</small></div>`;
    } else if(nextPrayer){
        const t = timeFormat==='12'?nextPrayer.time12:nextPrayer.time;
        el.innerHTML=`<div><strong>‡¶™‡¶∞‡¶¨‡¶∞‡ßç‡¶§‡ßÄ: ${nextPrayer.name}</strong><br><small>‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶π‡¶¨‡ßá ${document.getElementById('countdownTime').textContent} ‡¶è ${t}</small></div>`;
    }
}

// Update prayer cards
function updatePrayerTimesDisplay(currentPrayerName=''){
    if(!prayerTimes) return;
    const container=document.getElementById('prayerTimes');
    container.innerHTML='';
    prayerTimes.forEach(p=>{
        const isCurrent=p.name===currentPrayerName;
        const t=timeFormat==='12'?p.time12:p.time;
        const card=document.createElement('div');
        card.className=`prayer-card ${isCurrent?'current':''}`;
        card.innerHTML=`<div class="prayer-name">${p.icon} ${p.name}</div><div class="prayer-time">${t}</div>${p.duration>0?`<small>${p.duration} ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü</small>`:''}`;
        container.appendChild(card);
    });
}

// Time format
function setTimeFormat(f){
    timeFormat=f;
    document.querySelectorAll('.format-btn').forEach(b=>b.classList.remove('active'));
    event.target.classList.add('active');
    updatePrayerTimesDisplay();
    updatePrayerStatusDisplay();
}

// Current time
function updateCurrentTime(){
    const now=new Date();
    if(timeFormat==='12'){
        const opt={weekday:'long',year:'numeric',month:'long',day:'numeric',hour:'numeric',minute:'2-digit',second:'2-digit',hour12:true};
        currentTimeElement.textContent=now.toLocaleDateString('bn-BD',opt);
    } else{
        const opt={weekday:'long',year:'numeric',month:'long',day:'numeric',hour:'2-digit',minute:'2-digit',second:'2-digit',hour12:false};
        currentTimeElement.textContent=now.toLocaleDateString('bn-BD',opt);
    }
}

// Error
function showError(msg){appContent.innerHTML=`<div class="error"><i class="fas fa-exclamation-triangle"></i><div><p>${msg}</p><button class="retry-btn" onclick="getUserLocation()">‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®</button></div></div>`;}

// Start app
window.onload=initApp;
</script>
</body>
</html>
